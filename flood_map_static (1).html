
<!DOCTYPE html>
<html>
<head>
  <title>FloodAlert NavMap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 100vh; }
    .alert-box {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: rgba(255, 0, 0, 0.9);
      color: white;
      padding: 15px 20px;
      border-radius: 5px;
      z-index: 9999;
      font-family: sans-serif;
      animation: slidein 0.5s ease-out;
    }

    @keyframes slidein {
      from { top: -50px; opacity: 0; }
      to { top: 20px; opacity: 1; }
    }

    .legend {
      background: white;
      padding: 10px;
      line-height: 1.5;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([20.5937, 78.9629], 5);  // India center
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data © <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Static flood zone data (no backend)
    const floodZones = [
      { lat: 20.321, lon: 78.92, level: 'high' },
      { lat: 20.612, lon: 78.80, level: 'medium' },
      { lat: 21.002, lon: 78.72, level: 'low' }
    ];

    function addFloodZone(lat, lon, level) {
      const color = level === 'high' ? 'red' : level === 'medium' ? 'yellow' : 'blue';
      const circle = L.circle([lat, lon], {
        radius: 400,
        color: color,
        fillOpacity: 0.4
      }).addTo(map).bindPopup(level.toUpperCase() + ' flood risk');
    }

    floodZones.forEach(zone => {
      addFloodZone(zone.lat, zone.lon, zone.level);
    });

    // Legend
    const legend = L.control({ position: 'bottomright' });
    legend.onAdd = function () {
      const div = L.DomUtil.create('div', 'legend');
      div.innerHTML += '<strong>Flood Zones:</strong><br>';
      div.innerHTML += '<i style="background:red;width:10px;height:10px;display:inline-block;"></i> High Risk<br>';
      div.innerHTML += '<i style="background:yellow;width:10px;height:10px;display:inline-block;"></i> Medium Risk<br>';
      div.innerHTML += '<i style="background:blue;width:10px;height:10px;display:inline-block;"></i> Low Risk<br>';
      return div;
    };
    legend.addTo(map);

    // Location + Weather
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        const marker = L.marker([lat, lon]).addTo(map).bindPopup("You are here").openPopup();
        map.setView([lat, lon], 13);

        // Weather
        const apiKey = "YOUR_OPENWEATHERMAP_API_KEY";  // Replace this!
        fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`)
          .then(res => res.json())
          .then(data => {
            const rain = data.rain ? (data.rain["1h"] || 0) : 0;
            const humidity = data.main.humidity;
            const desc = data.weather[0].description;

            marker.setPopupContent(
              `<b>You are here</b><br>${desc}<br>🌧 Rain: ${rain} mm<br>💧 Humidity: ${humidity}%`
            ).openPopup();

            if (rain > 10) {
              showAlert("⚠️ Heavy Rain Warning! Possible local flooding.");
            }
          });
      });
    }

    function showAlert(message) {
      const alertBox = document.createElement('div');
      alertBox.className = 'alert-box';
      alertBox.innerHTML = message;
      document.body.appendChild(alertBox);
      setTimeout(() => alertBox.remove(), 5000);
    }
  </script>
</body>
</html>
